---
Date:`2019-5-26`
label:MPLS_VPN
---

# 正文
MPLS：多协议协议交换；
MPLS域一般由运营商部署；
数据包没有进入MPLS域之前，例如传给R3以及之前的数据包称为：==纯IP包==，进入MPLS域之后称为==标签包==

数据包根据标签转发；

## 一、Drawbacks of Traditional IP Routing

数据包转发仅仅基于目的IP；
每次转发都要查询路由表，耗费时间；



## 二、MPLS 的优势

### 优势一：流量管理TE：traffic engineering
在传统的IP网络中，网络流量一般根据OSPF协议，以最大带宽为目标进行选择路径，这样在如图所示的两条路径中，无论网络流量为多少都只会选择上方的路径；

而MPLS会均衡两条路径的流量；
传统IP场景：

![2]($resource/2.jpg)


### 优势二：减少对于路由表的转发查找：
![使用标签减少查询路由表]($resource/%E4%BD%BF%E7%94%A8%E6%A0%87%E7%AD%BE%E5%87%8F%E5%B0%91%E6%9F%A5%E8%AF%A2%E8%B7%AF%E7%94%B1%E8%A1%A8.jpg)
在最初的路由表 生成阶段，R1号路由器将自己的直连路由IP：10.1.1.1分配一个标签（一个数值），例如23，然后传给R2,同时R2也会为这条路由分配一个标签，例如25，同理R3也会分配一个标签，例如30；
然后数据包从R3向下转发，因为R3设定为MPLS域的边缘路由器，因此R3向下转发的时候，在IP地址前面加上标签25（加上的标签是下一级路由对该路由IP的标签），转发给R2，R2收到之后将标签30替换为23，就可以直接转发给R1，R1收到之后将标签弹出，变成纯IP包，然后查路由表继续转发；

其中：R1，R3位于MPLS域的边缘，称为边缘路由器；R1，R2，R3称为标签转发路由器；从R3到R1的路径称为标签转发路径；

- 理论上转发速度更快；
- MPLS提供特殊服务，可以区分不同用户；
- 适合网络流量工程的实施；
- 适合大型网络：例如ISP；



### 优势三：区分不同的用户
边缘路由器R3可以根据接收数据报的端口的不同，为不同的端口加上不同的标签，以此区别不同的用户数据报，这样即使目的IP相同（不同内网IP可以相同），也可以区分不同的数据包去向；
![3]($resource/3.jpg)


## 三、MPLS基本实验原理



## 四、MPLS包头封装位置和包头格式

![MPLS包头位置 2]($resource/MPLS%E5%8C%85%E5%A4%B4%E4%BD%8D%E7%BD%AE%202.jpg)

## MPLS架构及实现细节

### MPLS_VPN组件：
![MPLS_VPN组件]($resource/MPLS_VPN%E7%BB%84%E4%BB%B6.jpg)


### VRF技术：
![VRF技术]($resource/VRF%E6%8A%80%E6%9C%AF.jpg)
这里两个CE客户，将一个物理的实体PE虚拟出两个逻辑PE，一共三个PE，虚拟的两个PE分别存放各自CE上的路由表，三个之间相互隔离；将不同的接口连接到不同的PE上（包括虚拟的）


### RD技术：
使用VRF技术之后，可以在一段的PE上区分出两个不同CE传过来的相同的内网IP，但是从该PE使用BGP将路由表传递到另一个PE上时候，后一个PE仍然无法区分；可以使用RD：路由区分符，即相当于在每条路由器前面加上属于该网络的标记；

![RD服务]($resource/RD%E6%9C%8D%E5%8A%A1.jpg)

## 基础实验

## MPLS的现实好处



